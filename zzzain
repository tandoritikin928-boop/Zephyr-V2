-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local TeleportCheck = false
local queueTeleport = syn and syn.queue_on_teleport or queue_on_teleport

-- HyperShot本体URL
local MOBILE_URL = "https://raw.githubusercontent.com/TheRealAvrwm/Zephyr-V2/main/Games/HyperShotMobiles.lua"
local PC_URL     = "https://raw.githubusercontent.com/TheRealAvrwm/Zephyr-V2/main/Games/HypershotPc.lua"

-- rakki スクリプト URL (短縮版)
local RAKKI_URL = "https://raw.githubusercontent.com/tandoritikin928-boop/Zephyr-V2/main/rakki"

-- ===== Settings =====
getgenv().ZEPHYR = {
    GodMode = false,
    TargetHP = 100,
    DeathBypass = true
}

-- ===== UI =====
local gui = Instance.new("ScreenGui")
gui.Name = "ZEPHYR_UI"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromScale(0.28,0.3)
frame.Position = UDim2.fromScale(0.05,0.55)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

-- HP入力
local hpBox = Instance.new("TextBox", frame)
hpBox.Size = UDim2.fromScale(0.8,0.2)
hpBox.Position = UDim2.fromScale(0.1,0.05)
hpBox.PlaceholderText = "HP入力"
hpBox.Text = ""

local hpButton = Instance.new("TextButton", frame)
hpButton.Size = UDim2.fromScale(0.5,0.15)
hpButton.Position = UDim2.fromScale(0.25,0.3)
hpButton.Text = "適用"

-- GodModeトグル
local godToggle = Instance.new("TextButton", frame)
godToggle.Size = UDim2.fromScale(0.85,0.15)
godToggle.Position = UDim2.fromScale(0.075,0.5)
godToggle.Text = "God Mode : OFF"

-- 最小化ボタン
local minBtn = Instance.new("TextButton", frame)
minBtn.Size = UDim2.fromScale(0.15,0.15)
minBtn.Position = UDim2.fromScale(0.825,0)
minBtn.Text = "_"
minBtn.TextScaled = true
local minimized = false
minBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    frame.Size = minimized and UDim2.fromScale(0.05,0.05) or UDim2.fromScale(0.28,0.3)
end)

-- ===== HyperShot 実行関数 =====
local function getURL()
    if UserInputService.TouchEnabled then return MOBILE_URL
    else return PC_URL end
end

local function executeHyperShot()
    loadstring(game:HttpGet(getURL()))()
end

executeHyperShot() -- 初回実行

-- ===== Teleport Queue =====
LocalPlayer.OnTeleport:Connect(function()
    if not TeleportCheck and queueTeleport then
        TeleportCheck = true
        queueTeleport(string.format("loadstring(game:HttpGet(%q))()",getURL()))
    end
end)

TeleportService.TeleportInitFailed:Connect(function(player)
    if player == LocalPlayer and queueTeleport then
        queueTeleport(string.format("loadstring(game:HttpGet(%q))()",getURL()))
    end
end)

-- ===== rakki 実行 =====
loadstring(game:HttpGet(RAKKI_URL))()

-- ===== HP/GodMode監視 =====
local hum
local function bindChar(char)
    hum = char:WaitForChild("Humanoid")
    hum.MaxHealth = getgenv().ZEPHYR.TargetHP
    hum.Health = hum.MaxHealth

    RunService.Heartbeat:Connect(function()
        if hum then
            -- GodMode ON なら常に回復
            if getgenv().ZEPHYR.GodMode and hum.Health < getgenv().ZEPHYR.TargetHP then
                hum.Health = getgenv().ZEPHYR.TargetHP
            end
        end
    end)
end

if LocalPlayer.Character then bindChar(LocalPlayer.Character) end
LocalPlayer.CharacterAdded:Connect(bindChar)

-- ===== UIイベント =====
hpButton.MouseButton1Click:Connect(function()
    local n = tonumber(hpBox.Text)
    if n then getgenv().ZEPHYR.TargetHP = math.clamp(n,1,9999) end
end)

godToggle.MouseButton1Click:Connect(function()
    getgenv().ZEPHYR.GodMode = not getgenv().ZEPHYR.GodMode
    godToggle.Text = "God Mode : " .. (getgenv().ZEPHYR.GodMode and "ON" or "OFF")
end)
