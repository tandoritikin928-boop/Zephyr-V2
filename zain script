local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local GodModeEnabled = false
local HPOverrideEnabled = false
local CustomMaxHP = 100

-- UI
local gui = Instance.new("ScreenGui")
gui.Name = "HyperShotPanel"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.fromScale(0.26, 0.32)
frame.Position = UDim2.fromScale(0.05, 0.55)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.Parent = gui
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

local function label(text, y)
	local l = Instance.new("TextLabel")
	l.Size = UDim2.fromScale(1, 0.12)
	l.Position = UDim2.fromScale(0, y)
	l.BackgroundTransparency = 1
	l.Text = text
	l.TextScaled = true
	l.TextColor3 = Color3.fromRGB(255,255,255)
	l.Parent = frame
	return l
end

local function button(text, y)
	local b = Instance.new("TextButton")
	b.Size = UDim2.fromScale(0.85, 0.12)
	b.Position = UDim2.fromScale(0.075, y)
	b.Text = text
	b.TextScaled = true
	b.BackgroundColor3 = Color3.fromRGB(60,60,60)
	b.TextColor3 = Color3.fromRGB(255,255,255)
	b.Parent = frame
	Instance.new("UICorner", b).CornerRadius = UDim.new(0, 10)
	return b
end

local function textbox(placeholder, y)
	local t = Instance.new("TextBox")
	t.Size = UDim2.fromScale(0.85, 0.12)
	t.Position = UDim2.fromScale(0.075, y)
	t.PlaceholderText = placeholder
	t.Text = ""
	t.TextScaled = true
	t.BackgroundColor3 = Color3.fromRGB(40,40,40)
	t.TextColor3 = Color3.fromRGB(255,255,255)
	t.ClearTextOnFocus = false
	t.Parent = frame
	Instance.new("UICorner", t).CornerRadius = UDim.new(0, 10)
	return t
end

local title = label("HyperShot", 0.00)
local godStatus = label("God Mode : OFF", 0.12)
godStatus.TextColor3 = Color3.fromRGB(255,80,80)

local hpStatus = label("HP : -", 0.24)

local godToggle = button("Toggle God Mode", 0.36)

local hpInput = textbox("Enter Max HP (number)", 0.50)
local hpApply = button("Apply Max HP", 0.64)
local hpToggle = button("HP Override : OFF", 0.78)

-- ロジック
local healthConn, hbConn

local function ApplyModes(character)
	local humanoid = character:WaitForChild("Humanoid")
	local root = character:WaitForChild("HumanoidRootPart")

	if healthConn then healthConn:Disconnect() end
	if hbConn then hbConn:Disconnect() end

	if HPOverrideEnabled then
		humanoid.MaxHealth = CustomMaxHP
		humanoid.Health = CustomMaxHP
	end

	local SAFE_HP = 3
	local safeCFrame = root.CFrame

	hbConn = RunService.Heartbeat:Connect(function()
		hpStatus.Text = "HP : " .. math.floor(humanoid.Health)
		if GodModeEnabled and humanoid.FloorMaterial ~= Enum.Material.Air then
			safeCFrame = root.CFrame
		end
	end)

	healthConn = humanoid.HealthChanged:Connect(function(hp)
		if GodModeEnabled and hp <= SAFE_HP then
			humanoid.Health = humanoid.MaxHealth
			root.CFrame = safeCFrame
		end
	end)
end

-- UIイベント
godToggle.MouseButton1Click:Connect(function()
	GodModeEnabled = not GodModeEnabled
	godStatus.Text = "God Mode : " .. (GodModeEnabled and "ON" or "OFF")
	godStatus.TextColor3 = GodModeEnabled and Color3.fromRGB(80,255,80) or Color3.fromRGB(255,80,80)
	if LocalPlayer.Character then ApplyModes(LocalPlayer.Character) end
end)

hpApply.MouseButton1Click:Connect(function()
	local value = tonumber(hpInput.Text)
	if value and value > 0 then
		CustomMaxHP = math.floor(value)
		if HPOverrideEnabled and LocalPlayer.Character then
			ApplyModes(LocalPlayer.Character)
		end
	end
end)

hpToggle.MouseButton1Click:Connect(function()
	HPOverrideEnabled = not HPOverrideEnabled
	hpToggle.Text = HPOverrideEnabled and "HP Override : ON" or "HP Override : OFF"
	if LocalPlayer.Character then ApplyModes(LocalPlayer.Character) end
end)

LocalPlayer.CharacterAdded:Connect(function(char)
	ApplyModes(char)
end)
